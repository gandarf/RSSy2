# 설계 문서: RSSy2 - AI 기반 RSS 피드 요약기

## 1. 개요
이 문서는 RSSy2 애플리케이션의 설계 및 사양을 설명합니다. RSSy2는 RSS 피드를 주기적으로 가져와 Gemini AI 모델을 사용하여 내용을 요약하고, 이 요약들을 깔끔하고 보고서 형식으로 제공하는 애플리케이션입니다. 주요 목표는 사용자가 여러 소스의 뉴스 및 기사를 정보 과부하 없이 효율적으로 소비할 수 있도록 하는 것입니다.

## 2. 기능

### 2.1 핵심 기능
- **자동 RSS 가져오기:** 애플리케이션은 설정된 RSS 피드 URL 목록에서 주기적으로(예: 매시간, 구성 가능) 새로운 항목을 읽고 검색합니다.
- **AI 기반 요약 (Top 10 Selection):** RSS 피드에서 가져온 기사들의 제목을 바탕으로 Gemini가 가장 중요한 **Top 10 기사**를 선정합니다. 선정된 Top 10 기사는 Gemini가 각 150자 미만으로 핵심 내용을 요약합니다. Top 10에 포함되지 않은 나머지 기사들은 AI 요약을 거치지 않고 RSS feed에 있는 원래 내용을 그대로 보여줍니다. 이 방식은 효율성을 극대화하고 API 비용 및 부하를 줄입니다.
- **메인 표시 화면:** 기본 인터페이스(예: 웹 대시보드 또는 풍부한 CLI 출력)는 요약된 보고서를 읽기 쉬운 형식으로 표시하며, 피드 소스 또는 주제별로 분류될 수 있습니다.
- **보고서 생성:** 요약은 "깔끔한 보고서 형식"으로 제공되며, 가독성과 빠른 정보 검색에 중점을 둡니다. 여기에는 제목, 출처, 원본 링크 및 Gemini가 생성한 요약이 포함될 수 있습니다. 만일 RSS feed에서 가져올 수 있는 유의미한 사진이 있다면 사진도 보고서에 포함이 될 수 있습니다.
- **데이터 갱신 및 보존:** 보고서는 기본적으로 설정된 주기에 따라 feed를 가져와서 데이터베이스에 저장합니다. 사용자는 자동 갱신 기능을 켜거나 끌 수 있으며, 갱신 주기를 설정할 수 있습니다. 사용자에게는 최근 24시간(또는 설정된 기간)의 요약만 필터링하여 보여줍니다. 오래된 데이터는 별도의 정리 작업(Cleanup Job)을 통해 주기적으로 삭제하여 데이터베이스 크기를 관리합니다. 별도의 refresh 버튼을 누르면 즉시 feed를 읽어들여 추가합니다.

### 2.2 설정 화면
- **RSS 피드 관리:** 전용 설정 인터페이스를 통해 사용자는 다음을 수행할 수 있습니다:
    - 새 RSS 피드 URL 추가.
    - 기존 RSS 피드 URL 편집.
    - RSS 피드 URL 삭제.
    - 개별 피드 활성화/비활성화.
- **스케줄링 옵션:**
    - **자동 갱신 (Auto-refresh):** 자동 갱신 기능을 켜거나 끌 수 있는 토글 스위치.
    - **갱신 주기 (Refresh Interval):** 자동 갱신이 활성화된 경우, 피드를 가져오는 간격을 설정 (예: 1시간, 2시간, 4시간 등).
- **Gemini API 키 관리:** `.env` 파일을 사용하여 Gemini API 키를 안전하게 저장하고 관리합니다. 소스 코드에 키가 노출되지 않도록 합니다.

## 3. 기술 스택

- **백엔드 언어:** Python 3.x
- **AI 통합:** Google Gemini API (공식 또는 커뮤니티 Python 클라이언트 라이브러리 사용).
- **웹 프레임워크 (UI에 적용 가능한 경우):** 비동기 처리와 성능을 위해 **FastAPI**를 사용합니다.
- **데이터 저장:** 동시성 문제 해결과 안정적인 데이터 관리를 위해 **SQLite**를 사용합니다. (Python 내장 라이브러리 `sqlite3` 활용)
- **스케줄러:** 주기적인 작업을 위해 `APScheduler` 또는 애플리케이션에서 관리하는 간단한 `cron` 작업.
- **배포 환경:** 가정용 Linux 서버 (예: Raspberry Pi, NAS 또는 Linux를 실행하는 구형 데스크톱).

## 4. 아키텍처

애플리케이션은 다음과 같은 구성 요소로 나눌 수 있는 모듈식 아키텍처를 따릅니다.

- **스케줄러 모듈:** 정의된 간격으로 피드 가져오기 프로세스를 트리거하는 역할을 합니다.
- **RSS 가져오기 모듈:** 구성된 RSS URL에서 XML/JSON 데이터를 검색하고, 이를 파싱하여 관련 기사 정보(제목, 링크, 내용/설명)를 추출합니다.
- **Gemini 요약기 모듈:** Gemini API와 상호 작용하여 기사를 선별하고 요약을 수행합니다.
    - **Top 10 선정:** 가져온 기사들의 '제목' 목록을 Gemini에 전달하여 중요도순으로 Top 10을 선정합니다.
    - **요약 생성:** 선정된 Top 10 기사에 대해서만 Gemini가 내용을 분석하여 150자 미만으로 요약합니다.
    - **전처리:** HTML 태그 제거 및 본문 텍스트 추출을 통해 토큰 사용량을 최적화합니다.
    - **비 Top 10 처리:** Top 10에 들지 못한 기사들은 별도의 AI 요약 과정을 거치지 않고 RSS에서 제공하는 Description을 그대로 사용합니다.
    - **속도 제한(Rate Limiting):** API 호출 제한(RPM)을 준수하기 위해 대기 시간(`time.sleep`) 또는 큐(Queue)를 사용합니다.
    - **오류 처리:** API 호출 실패 시 해당 항목만 건너뛰고 나머지는 진행하는 부분 실패(Partial Failure) 처리를 포함합니다.
- **데이터 저장 모듈:** 피드, 기사 및 요약을 **SQLite 데이터베이스**에 저장하고 관리합니다. 동시성 제어를 고려하여 트랜잭션을 관리합니다.
- **표시 모듈:** 요약된 보고서를 표시용으로 렌더링합니다(예: 웹 인터페이스용 HTML 템플릿 또는 CLI용 형식화된 콘솔 출력).
- **구성 모듈:** RSS 피드 URL 및 스케줄링 기본 설정을 포함한 설정을 관리합니다.

```
+----------------+       +-------------------+       +--------------------+
| 스케줄러       | ----> | RSS 가져오기      | ----> | Gemini 요약기      |
| (예: APScheduler) |   | (예: feedparser)  |       | (Gemini API)       |
+----------------+       +-------------------+       +--------------------+
        |                               ^
        v                               |
+--------------------+               +--------------------+
| 데이터 저장소      | <------------ | 데이터 저장소      |
| (SQLite DB)        | (기사 쓰기)   | (피드 읽기)        |
+--------------------+               +--------------------+
        |
        v
+--------------------+
| 표시 모듈          |
| (웹 UI/CLI 출력)   |
+--------------------+
        ^
        |
+--------------------+
| 구성 UI            |
| (웹 UI/CLI 구성)   |
+--------------------+
```

## 5. 데이터 모델 (SQLite 스키마)

애플리케이션은 `rssy2.db` SQLite 데이터베이스를 사용하며, 주요 테이블은 `feeds`, `articles`, `settings`입니다.

### 테이블: `feeds`
RSS 피드 목록을 저장합니다.

```sql
CREATE TABLE feeds (
    id TEXT PRIMARY KEY,          -- UUID
    url TEXT NOT NULL,            -- RSS 피드 URL
    name TEXT,                    -- 피드 이름
    is_active BOOLEAN DEFAULT 1,  -- 활성화 여부
    last_fetched_at DATETIME      -- 마지막 성공적 가져오기 시간 (ISO 8601)
);
```

### 테이블: `articles`
가져온 기사 및 요약 정보를 저장합니다.

```sql
CREATE TABLE articles (
    id TEXT PRIMARY KEY,          -- UUID
    feed_id TEXT,                 -- feeds 테이블의 id 참조 (Foreign Key)
    title TEXT,                   -- 기사 제목
    original_url TEXT,            -- 원본 기사 URL
    published_at DATETIME,        -- 기사 게시 시간 (ISO 8601)
    raw_content TEXT,             -- 원본 기사 내용 (전처리 전/후 선택적 저장)
    summary TEXT,                 -- Gemini 생성 요약
    summarized_at DATETIME,       -- 요약 생성 시간
    image_url TEXT,               -- 기사 관련 이미지 URL
    FOREIGN KEY(feed_id) REFERENCES feeds(id)
);

### 테이블: `settings`
사용자의 애플리케이션 설정을 저장합니다.

```sql
CREATE TABLE settings (
    key TEXT PRIMARY KEY,         -- 설정 키 (예: 'auto_refresh', 'refresh_interval')
    value TEXT                    -- 설정 값
);
```
```

**참고:**
- `id`는 UUID v4를 사용하여 생성합니다.
- 날짜/시간은 UTC 기준 ISO 8601 문자열로 저장하거나, SQLite의 `DATETIME` 타입을 활용합니다.

## 6. UI/UX 고려 사항

### 6.1 메인 디스플레이
- **웹 인터페이스:** (가정용 서버에 선호) 요약된 기사 목록을 보여주는 간단하고 반응형 웹 대시보드. 각 요약은 더 많은 세부 정보를 표시하거나 원본 기사로 연결하기 위해 확장될 수 있습니다. 피드, 날짜, 키워드별 필터링 및 정렬 옵션은 유용성을 향상시킬 것입니다.
- **CLI 인터페이스:** 페이지 매김 및 검색 기능과 함께 요약을 터미널에 직접 출력하는 명령줄 도구.

### 6.2 구성
- **웹 인터페이스:** RSS 피드 관리, API 키 입력 및 일정 설정을 위한 양식.
- **CLI 인터페이스:** 피드 추가, 제거, 나열 및 기타 설정 관리를 위한 명령.

## 7. 개발 로드맵 (고수준)

1. **프로젝트 설정:** Python 프로젝트 초기화, 가상 환경 설정, 기본 종속성 관리.
2. **데이터베이스 설정:** SQLite 데이터베이스 스키마 설계 및 초기화 스크립트 작성.
3. **RSS 가져오기:** RSS 피드를 가져오고 파싱하는 기능 구현.
4. **Gemini 통합:** 요약을 위한 Gemini API 호출 구현 (전처리 및 Rate Limiting 포함).
5. **데이터 저장 로직:** 가져온 기사 및 요약을 SQLite 데이터베이스에 저장 (트랜잭션 처리).
6. **메인 디스플레이 (기본):** 요약을 볼 수 있는 기본적인 방법 구현 (CLI 또는 간단한 HTML 페이지).
7. **구성 (기본):** RSS 피드 관리를 위한 CLI 명령 또는 기본 웹 양식 구현.
8. **스케줄링:** 주기적인 가져오기를 위한 스케줄러 통합.
9. **오류 처리 및 로깅:** 강력한 오류 처리, 로깅 및 재시도 메커니즘.
10. **개선:** UI/UX 개선, 더 많은 구성 옵션 추가, 보고서 형식 개선.
11. **배포 스크립트:** Linux 서버에 배포하기 위한 기본 스크립트 또는 지침.

## 8. 향후 개선 사항

- **사용자 인증:** 여러 사용자가 의도된 경우.
- **고급 필터링/검색:** 요약 내에서 더 강력한 검색 기능.
- **카테고리/태그 지정:** 기사의 자동 또는 수동 카테고리 지정.
- **알림 시스템:** 새 요약에 대한 이메일 또는 푸시 알림.
- **감정 분석:** Gemini를 사용하여 기사의 감정 분석.
- **도커라이제이션:** 더 쉬운 배포를 위해 애플리케이션을 도커 컨테이너에 패키징.
